<!DOCTYPE html>
<html lang="en">

<head>

    <title>BHealthy</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="CareMed demo project">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
    <link href="plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.carousel.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles/main_styles.css">
    <link rel="stylesheet" type="text/css" href="styles/home.css">
    <link rel="stylesheet" type="text/css" href="styles/addprescription.css">
    <script src="js/url.js"></script>


</head>

<body>

    <div class="super_container">

        <!-- Header -->

        <header class="header trans_200">

                <!-- Top Bar -->
                <div class="top_bar">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="top_bar_content d-flex flex-row align-items-center justify-content-start">
                                    <div class="top_bar_item "><a href="doctorList2.html">Request an Appointment</a></div>
                                    <div
                                        class="top_bar_item_register  d-flex flex-row align-items-center justify-content-start ml-auto">
                                        <a href="#con" id="register">Register</a>
                                        <div id="con">
                                            <h4><input type="radio" name="role" value="1" /> As a Doctor</h4> <br> <br>
                                            <h4><input type="radio" name="role" value="0" /> As a Patient</h4>
                                        </div>
                                        <script>
                                            $('input:radio[name="role"]').change(
                                                function () {
                                                    if ($(this).is(':checked') && $(this).val() == '1') {
                                                        window.location = "doctor_signup.html";
                                                    }
                                                    else {
                                                        window.location = "sign_up.html";
                                                    }
                                                });
                                        </script>
                                    </div>
    
                                    <div class="top_bar_item_logIn  d-flex flex-row align-items-center"><a href="login.html"
                                            id="login">Login</a></div>
    
    
                                    <div class="dropdown" id="menu">
                                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"
                                            id="dropdown">hello
                                            <span class="caret"></span></button>
                                        <ul class="dropdown-content">
                                            <li><a href="patient_profile.html">My Profile</a></li>
                                            
                                            <li><a id="my_prescription">My Prescription</a></li>
                                            <li><a href="addprescription.html">ADD Prescription</a></li>
                                            <li><a href="myappointment.html">Track My Appointment</a></li>
                                            <li><a href="javascript: logout()">Logout</a></li>
                                        </ul>
                                        
                                    </div>
                                    <script>
                                        function logout() {
                                            window.localStorage.clear();
                                            window.location.replace("home.html");
                                        }
                                    </script>
                                    <script>
    
    
                                        if (window.localStorage.getItem('user') == null) {
                                            document.getElementById('register').style.display = "block";
                                            document.getElementById('login').style.display = "block";
                                            document.getElementById('menu').style.display = "none";
    
    
                                        }
                                        else {
                                            document.getElementById('register').style.display = "none";
                                            document.getElementById('login').style.display = "none";
                                            document.getElementById('menu').style.display = "block";
    
                                            var data = window.localStorage.getItem('user');
                                            var obj = JSON.parse(data);
    
    
                                            document.getElementById('dropdown').innerHTML = obj.name;
                                            var my_prescription = document.getElementById("my_prescription");
                                            my_prescription.setAttribute('href',"my_prescription.html?id="+obj.phonenumber)
    
                                        }
                                    </script>
    
    
                                    <div class="top_bar_item_logIn  d-flex flex-row align-items-center" id="username"><a
                                            href="login.html" style="display:none;">Nayeem</a></div>
    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Header Content -->
                <div class="header_container">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="header_content d-flex flex-row align-items-center justify-content-start">
                                    <nav class="main_nav ml-auto">
                                        <ul>
                                            <li><a href="home.html">Home</a></li>
                                            <li><a href="department.html">Department</a></li>
                                            <li><a href="doctorList2.html">Doctor</a></li>
                                             <li><a href="about.html">About us</a></li>
                                            <!-- <li><a href="contact.html">Contact us</a></li> --> 
                                        </ul>
                                    </nav>
                                    <div class="hamburger ml-auto"><i class="fa fa-bars" aria-hidden="true"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Logo -->
                <div class="logo_container_outer">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="logo_container">
                                    <a href="#">
                                        <div
                                            class="logo_content d-flex flex-column align-items-start justify-content-center">
                                            <div class="logo_line"></div>
                                            <div class="logo d-flex flex-row align-items-center justify-content-center">
                                                <div class="logo_text">B<span>Healthy</span></div>
                                                <div class="logo_box">+</div>
                                            </div>
                                            <div class="logo_sub">Health Care Center</div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
    

        <div class="flex-container">

            <div class="title">prescription</div>
            <div class="row row-lg-eq-height">
                <div class="col-lg-6">
                    <div class="sub_container">



                        <div class="form">
                            <label>Doctor Name :</label>
                            <input type="text" class="input" id="doctorname" placeholder="Doctor Name">
                        </div>

                        <div class="form">
                            <label>Department :</label>
                            <input type="text" class="input" id="department" placeholder="Department">
                        </div>

                        <div class="form">
                            <label>Date :</label>
                            <input type="date" class="input" id="date" placeholder="Date">
                        </div>

                        <div class="button login_btn">
                            <a href="javascript: addprescription();">Add</a></div>

                    </div>

                </div>

                <div class="col-lg-6" style="margin-top: 100px;">
                    <div class="img_container">

                        <input type="file" accept="image/" id="propic">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        function addprescription() {

            
            var myurl = backendurl +"api/upload-prescrption"
            var xhr = new XMLHttpRequest();

            var data;
            data = JSON.parse(window.localStorage.getItem('user'));
            xhr.open("POST", myurl, true);
            token = data.accessToken;
            
            xhr.setRequestHeader("Authorization", "Bearer " + token);
            //   xhr.setRequestHeader("Content-Type", "application/json");
            var formData = new FormData();
            var file = propic.files[0];
            var doctor_name = document.getElementById('doctorname').value;
            var department = document.getElementById('department').value;
            var date = document.getElementById('date').value;
            if (file == null) {
                alert('Please upload Image')
            }
            
            else {
                formData.append("file", file);


                formData.append("prescription_detailes", new Blob([JSON.stringify({
                    
                    "phonenumber": data.phonenumber,
                    "doctor_name": doctor_name,
                    "department": department,
                    "date": date
                })], {
                    type: "application/json",
                    processData: false, contentType: false, cache: false
                }));



                var response = xhr.response;
                xhr.onload = function () {
                    if (this.status == 200) {
                        // Here we go on the new page
                        // var jsonResponse = JSON.parse(response);
                        console.log(JSON.stringify(response));
                        // $("#loadMe").modal("hide");
                        window.location.replace("home.html");
                    }
                    else {

                        // $('#loadMe').hide();
                        alert("Wrong Phone Number or Password");
                    }
                };
                xhr.send(formData);
            }
        }

    </script>

</body>

</html>


<!-- Home -->